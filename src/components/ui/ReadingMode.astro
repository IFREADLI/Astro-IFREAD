---
// 阅读模式组件
---

<div class="reading-mode-toggle" id="reading-mode-toggle">
  <button
    class="reading-mode-button"
    aria-label="切换阅读模式"
    title="专注阅读模式"
  >
    <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" />
    </svg>
    <span class="ml-2">阅读模式</span>
  </button>
</div>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const readingModeToggle = document.getElementById('reading-mode-toggle');
    const readingModeButton = readingModeToggle.querySelector('.reading-mode-button');
    let isReadingMode = false;
    
    // 创建阅读模式容器
    const readingModeContainer = document.createElement('div');
    readingModeContainer.id = 'reading-mode-container';
    readingModeContainer.className = 'reading-mode-container';
    readingModeContainer.style.display = 'none';
    
    // 创建阅读模式内容区域
    const readingModeContent = document.createElement('div');
    readingModeContent.className = 'reading-mode-content';
    
    // 创建关闭按钮
    const closeButton = document.createElement('button');
    closeButton.className = 'reading-mode-close';
    closeButton.innerHTML = `
      <svg class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
      </svg>
    `;
    closeButton.setAttribute('aria-label', '退出阅读模式');
    
    // 添加到容器
    readingModeContainer.appendChild(closeButton);
    readingModeContainer.appendChild(readingModeContent);
    document.body.appendChild(readingModeContainer);
    
    // 进入阅读模式
    function enterReadingMode() {
      const articleContent = document.querySelector('main.prose, .prose');
      if (!articleContent) return;
      
      // 复制文章内容
      readingModeContent.innerHTML = articleContent.innerHTML;
      
      // 显示阅读模式容器
      readingModeContainer.style.display = 'flex';
      
      // 滚动到顶部
      window.scrollTo(0, 0);
      
      // 隐藏主滚动条
      document.body.style.overflow = 'hidden';
      
      // 更新按钮状态
      readingModeButton.classList.add('active');
      isReadingMode = true;
      
      // 触发自定义事件
      window.dispatchEvent(new CustomEvent('readingmodechange', {
        detail: { isActive: true }
      }));
    }
    
    // 退出阅读模式
    function exitReadingMode() {
      // 隐藏阅读模式容器
      readingModeContainer.style.display = 'none';
      
      // 恢复主滚动条
      document.body.style.overflow = '';
      
      // 更新按钮状态
      readingModeButton.classList.remove('active');
      isReadingMode = false;
      
      // 触发自定义事件
      window.dispatchEvent(new CustomEvent('readingmodechange', {
        detail: { isActive: false }
      }));
    }
    
    // 切换阅读模式
    function toggleReadingMode() {
      if (isReadingMode) {
        exitReadingMode();
      } else {
        enterReadingMode();
      }
    }
    
    // 绑定事件
    readingModeButton.addEventListener('click', toggleReadingMode);
    closeButton.addEventListener('click', exitReadingMode);
    
    // ESC键退出阅读模式
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && isReadingMode) {
        exitReadingMode();
      }
    });
    
    // 监听主题变化
    window.addEventListener('themechange', (e) => {
      if (isReadingMode) {
        // 如果在阅读模式下，更新容器主题类
        const theme = e.detail.theme;
        if (theme === 'dark') {
          readingModeContainer.classList.add('dark');
        } else {
          readingModeContainer.classList.remove('dark');
        }
      }
    });
    
    // 初始化主题
    const currentTheme = window.getCurrentTheme ? window.getCurrentTheme() : 'light';
    if (currentTheme === 'dark') {
      readingModeContainer.classList.add('dark');
    }
  });
</script>

<style>
  .reading-mode-toggle {
    position: relative;
  }

  .reading-mode-button {
    display: flex;
    align-items: center;
    padding: 8px 12px;
    border-radius: 6px;
    background: transparent;
    border: 1px solid #e5e7eb;
    color: #6b7280;
    font-size: 14px;
    cursor: pointer;
    transition: all 0.2s ease;
  }

  .reading-mode-button:hover {
    background-color: #f9fafb;
    border-color: #d1d5db;
    color: #374151;
  }

  .reading-mode-button.active {
    background-color: #eff6ff;
    border-color: #3b82f6;
    color: #3b82f6;
  }

  @media (prefers-color-scheme: dark) {
    .reading-mode-button {
      border-color: #4b5563;
      color: #9ca3af;
    }

    .reading-mode-button:hover {
      background-color: #374151;
      border-color: #6b7280;
      color: #e5e7eb;
    }

    .reading-mode-button.active {
      background-color: #1e3a8a;
      border-color: #60a5fa;
      color: #60a5fa;
    }
  }

  .reading-mode-container {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: #ffffff;
    z-index: 100;
    flex-direction: column;
    overflow-y: auto;
    transition: all 0.3s ease;
  }

  .reading-mode-container.dark {
    background-color: #111827;
    color: #f9fafb;
  }

  .reading-mode-close {
    position: absolute;
    top: 20px;
    right: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background-color: rgba(0, 0, 0, 0.1);
    border: none;
    color: #6b7280;
    cursor: pointer;
    transition: all 0.2s ease;
    z-index: 10;
  }

  .reading-mode-close:hover {
    background-color: rgba(0, 0, 0, 0.2);
    color: #374151;
  }

  .reading-mode-container.dark .reading-mode-close {
    background-color: rgba(255, 255, 255, 0.1);
    color: #9ca3af;
  }

  .reading-mode-container.dark .reading-mode-close:hover {
    background-color: rgba(255, 255, 255, 0.2);
    color: #e5e7eb;
  }

  .reading-mode-content {
    max-width: 800px;
    margin: 80px auto 40px;
    padding: 0 40px;
    line-height: 1.8;
    font-size: 18px;
  }

  @media (max-width: 768px) {
    .reading-mode-content {
      margin: 60px auto 30px;
      padding: 0 20px;
      font-size: 16px;
    }
  }

  /* 阅读模式下的内容样式 */
  .reading-mode-content h1,
  .reading-mode-content h2,
  .reading-mode-content h3,
  .reading-mode-content h4,
  .reading-mode-content h5,
  .reading-mode-content h6 {
    margin-top: 2.5rem;
    margin-bottom: 1.5rem;
    font-weight: 600;
    line-height: 1.3;
  }

  .reading-mode-content h1 {
    font-size: 2.5rem;
  }

  .reading-mode-content h2 {
    font-size: 2rem;
  }

  .reading-mode-content h3 {
    font-size: 1.5rem;
  }

  .reading-mode-content p {
    margin-bottom: 1.5rem;
  }

  .reading-mode-content img {
    max-width: 100%;
    height: auto;
    border-radius: 8px;
    margin: 2rem 0;
  }

  .reading-mode-content blockquote {
    margin: 2rem 0;
    padding: 1rem 1.5rem;
    border-left: 4px solid #e5e7eb;
    background-color: #f9fafb;
    font-style: italic;
  }

  .reading-mode-container.dark .reading-mode-content blockquote {
    border-left-color: #4b5563;
    background-color: #1f2937;
  }

  .reading-mode-content pre {
    margin: 2rem 0;
    padding: 1.5rem;
    border-radius: 8px;
    overflow-x: auto;
    background-color: #f3f4f6;
  }

  .reading-mode-container.dark .reading-mode-content pre {
    background-color: #1f2937;
  }

  .reading-mode-content code {
    padding: 0.2rem 0.4rem;
    border-radius: 4px;
    background-color: #f3f4f6;
    font-size: 0.9em;
  }

  .reading-mode-container.dark .reading-mode-content code {
    background-color: #374151;
  }

  .reading-mode-content a {
    color: #3b82f6;
    text-decoration: underline;
  }

  .reading-mode-container.dark .reading-mode-content a {
    color: #60a5fa;
  }
</style>