---
// 加载动画组件
// 提供多种加载动画样式

export interface Props {
  type?: 'spinner' | 'dots' | 'pulse' | 'skeleton';
  size?: 'sm' | 'md' | 'lg';
  color?: 'primary' | 'secondary' | 'accent';
  text?: string;
  fullScreen?: boolean;
}

const { 
  type = 'spinner',
  size = 'md',
  color = 'primary',
  text = '',
  fullScreen = false
} = Astro.props;

// 根据类型和大小设置样式
const sizeClasses = {
  sm: {
    spinner: 'w-4 h-4',
    dots: 'space-x-1',
    pulse: 'w-6 h-6',
    skeleton: 'h-4'
  },
  md: {
    spinner: 'w-8 h-8',
    dots: 'space-x-2',
    pulse: 'w-12 h-12',
    skeleton: 'h-6'
  },
  lg: {
    spinner: 'w-12 h-12',
    dots: 'space-x-3',
    pulse: 'w-16 h-16',
    skeleton: 'h-8'
  }
};

const colorClasses = {
  primary: 'text-primary',
  secondary: 'text-secondary',
  accent: 'text-accent'
};

const dotSizeClasses = {
  sm: 'w-1 h-1',
  md: 'w-2 h-2',
  lg: 'w-3 h-3'
};

const containerClass = fullScreen 
  ? 'fixed inset-0 flex items-center justify-center bg-primary/10 dark:bg-secondary/10 z-50'
  : 'flex items-center justify-center';
---

<div class={containerClass}>
  {type === 'spinner' && (
    <div class="flex flex-col items-center">
      <svg 
        class={`animate-spin ${sizeClasses[size].spinner} ${colorClasses[color]}`} 
        xmlns="http://www.w3.org/2000/svg" 
        fill="none" 
        viewBox="0 0 24 24"
      >
        <circle 
          class="opacity-25" 
          cx="12" 
          cy="12" 
          r="10" 
          stroke="currentColor" 
          stroke-width="4"
        ></circle>
        <path 
          class="opacity-75" 
          fill="currentColor" 
          d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"
        ></path>
      </svg>
      {text && <p class={`mt-2 text-sm ${colorClasses[color]}`}>{text}</p>}
    </div>
  )}
  
  {type === 'dots' && (
    <div class="flex flex-col items-center">
      <div class={`flex ${sizeClasses[size].dots}`}>
        <div class={`${dotSizeClasses[size]} ${colorClasses[color]} rounded-full animate-pulse`}></div>
        <div class={`${dotSizeClasses[size]} ${colorClasses[color]} rounded-full animate-pulse`} style="animation-delay: 0.2s"></div>
        <div class={`${dotSizeClasses[size]} ${colorClasses[color]} rounded-full animate-pulse`} style="animation-delay: 0.4s"></div>
      </div>
      {text && <p class={`mt-2 text-sm ${colorClasses[color]}`}>{text}</p>}
    </div>
  )}
  
  {type === 'pulse' && (
    <div class="flex flex-col items-center">
      <div class={`${sizeClasses[size].pulse} ${colorClasses[color]} rounded-full animate-ping`}></div>
      <div class={`${sizeClasses[size].pulse} ${colorClasses[color]} rounded-full absolute animate-pulse`}></div>
      {text && <p class={`mt-2 text-sm ${colorClasses[color]}`}>{text}</p>}
    </div>
  )}
  
  {type === 'skeleton' && (
    <div class="w-full">
      <div class={`${sizeClasses[size].skeleton} bg-primary/20 dark:bg-secondary/20 rounded animate-pulse mb-2`}></div>
      <div className={`${sizeClasses[size].skeleton} bg-primary/20 dark:bg-secondary/20 rounded animate-pulse mb-2 w-4/5`}></div>
      <div className={`${sizeClasses[size].skeleton} bg-primary/20 dark:bg-secondary/20 rounded animate-pulse w-3/5`}></div>
      {text && <p class={`mt-2 text-sm ${colorClasses[color]}`}>{text}</p>}
    </div>
  )}
</div>

<script>
  // 全局加载状态管理
  document.addEventListener('DOMContentLoaded', () => {
    // 创建全屏加载容器
    if (!document.getElementById('global-loading-container')) {
      const container = document.createElement('div');
      container.id = 'global-loading-container';
      container.className = 'fixed inset-0 bg-primary/10 dark:bg-secondary/10 z-50 flex items-center justify-center hidden';
      document.body.appendChild(container);
    }
    
    // 显示全局加载
    window.showGlobalLoading = function(options = {}) {
      const {
        type = 'spinner',
        size = 'md',
        color = 'primary',
        text = '加载中...'
      } = options;
      
      const container = document.getElementById('global-loading-container');
      if (!container) return;
      
      // 创建加载内容
      let content = '';
      
      if (type === 'spinner') {
        const sizeClass = size === 'sm' ? 'w-4 h-4' : size === 'lg' ? 'w-12 h-12' : 'w-8 h-8';
        const colorClass = color === 'secondary' ? 'text-secondary' : color === 'accent' ? 'text-accent' : 'text-primary';
        
        content = `
          <div class="flex flex-col items-center">
            <svg class="animate-spin ${sizeClass} ${colorClass}" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
              <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
              <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
            <p class="mt-2 text-sm ${colorClass}">${text}</p>
          </div>
        `;
      } else if (type === 'dots') {
        const spaceClass = size === 'sm' ? 'space-x-1' : size === 'lg' ? 'space-x-3' : 'space-x-2';
        const dotClass = size === 'sm' ? 'w-1 h-1' : size === 'lg' ? 'w-3 h-3' : 'w-2 h-2';
        const colorClass = color === 'secondary' ? 'text-secondary' : color === 'accent' ? 'text-accent' : 'text-primary';
        
        content = `
          <div class="flex flex-col items-center">
            <div class="flex ${spaceClass}">
              <div class="${dotClass} ${colorClass} rounded-full animate-pulse"></div>
              <div class="${dotClass} ${colorClass} rounded-full animate-pulse" style="animation-delay: 0.2s"></div>
              <div class="${dotClass} ${colorClass} rounded-full animate-pulse" style="animation-delay: 0.4s"></div>
            </div>
            <p class="mt-2 text-sm ${colorClass}">${text}</p>
          </div>
        `;
      }
      
      container.innerHTML = content;
      container.classList.remove('hidden');
    };
    
    // 隐藏全局加载
    window.hideGlobalLoading = function() {
      const container = document.getElementById('global-loading-container');
      if (container) {
        container.classList.add('hidden');
      }
    };
  });
</script>