---
// 阅读进度指示器组件
---

<!-- 阅读进度条 -->
<div class="fixed top-0 left-0 w-full h-1 bg-gray-200 dark:bg-gray-700 z-50">
  <div id="reading-progress" class="h-full bg-primary-600 dark:bg-primary-400 transition-all duration-150" style="width: 0%"></div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const progressBar = document.getElementById('reading-progress');
    
    if (!progressBar) return;
    
    // 获取文章内容区域
    const article = document.querySelector('main.prose');
    if (!article) return;
    
    // 计算阅读进度
    const updateReadingProgress = () => {
      // 获取文章内容的位置信息
      const articleTop = article.offsetTop;
      const articleHeight = article.offsetHeight;
      
      // 获取当前滚动位置
      const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
      
      // 获取视口高度
      const windowHeight = window.innerHeight;
      
      // 计算阅读进度
      // 从文章顶部开始，到文章底部结束
      const progressStart = articleTop - windowHeight / 2;
      const progressEnd = articleTop + articleHeight - windowHeight / 2;
      
      let progress = 0;
      
      if (scrollTop >= progressEnd) {
        // 已经滚动到文章底部
        progress = 100;
      } else if (scrollTop >= progressStart) {
        // 在文章范围内滚动
        progress = ((scrollTop - progressStart) / (progressEnd - progressStart)) * 100;
      }
      
      // 更新进度条宽度
      progressBar.style.width = `${Math.min(100, Math.max(0, progress))}%`;
    };
    
    // 监听滚动事件
    window.addEventListener('scroll', updateReadingProgress);
    
    // 监听窗口大小变化
    window.addEventListener('resize', updateReadingProgress);
    
    // 初始化进度
    updateReadingProgress();
  });
</script>