---
import type { SearchResult } from '../../utils/search';

interface Props {
  results: SearchResult[];
  query: string;
  totalPosts: number;
}

const { results, query, totalPosts } = Astro.props;
---

<div class="search-results">
  {query ? (
    <>
      <!-- 搜索结果统计 -->
      <div class="mb-6 p-4 bg-gray-50 dark:bg-gray-800 rounded-lg">
        <p class="text-gray-700 dark:text-gray-300">
          找到 <span class="font-semibold">{results.length}</span> 篇关于 "
          <span class="font-semibold">{query}</span>" 的文章
          {results.length < totalPosts && (
            <>，共搜索了 {totalPosts} 篇文章</>
          )}
        </p>
      </div>
      
      <!-- 搜索结果列表 -->
      {results.length > 0 ? (
        <div class="space-y-6">
          {results.map(result => (
            <article class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 hover:shadow-lg transition-shadow">
              <!-- 文章标题 -->
              <h3 class="text-xl font-semibold mb-2">
                <a 
                  href={result.url} 
                  class="text-accent hover:text-accent/80 transition-colors"
                >
                  <span set:html={result.highlightedTitle || result.title}></span>
                </a>
              </h3>
              
              <!-- 文章元信息 -->
              <div class="flex flex-wrap items-center gap-2 mb-3 text-sm text-gray-600 dark:text-gray-400">
                {result.category && (
                  <span class="flex items-center">
                    <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 20 20">
                      <path d="M7 3a1 1 0 000 2h6a1 1 0 100-2H7zM4 7a1 1 0 011-1h10a1 1 0 110 2H5a1 1 0 01-1-1zM2 11a2 2 0 012-2h12a2 2 0 012 2v4a2 2 0 01-2 2H4a2 2 0 01-2-2v-4z"></path>
                    </svg>
                    {result.category}
                  </span>
                )}
                
                <span class="flex items-center">
                  <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd"></path>
                  </svg>
                  {result.publishDate.toLocaleDateString('zh-CN')}
                </span>
              </div>
              
              <!-- 文章描述 -->
              <div class="mb-4 text-gray-700 dark:text-gray-300">
                <span set:html={result.highlightedDescription || result.description}></span>
              </div>
              
              <!-- 标签 -->
              {result.tags && result.tags.length > 0 && (
                <div class="flex flex-wrap gap-2 mb-4">
                  {result.tags.map(tag => (
                    <a 
                      href={`/tags/${encodeURIComponent(tag)}/`}
                      class="inline-block px-2 py-1 text-xs bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors"
                    >
                      #{tag}
                    </a>
                  ))}
                </div>
              )}
              
              <!-- 阅读更多链接 -->
              <a 
                href={result.url} 
                class="inline-flex items-center text-accent hover:text-accent/80 transition-colors font-medium"
              >
                阅读更多
                <svg class="w-4 h-4 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                </svg>
              </a>
            </article>
          ))}
        </div>
      ) : (
        <!-- 无搜索结果 -->
        <div class="text-center py-12">
          <div class="mb-4">
            <svg class="w-16 h-16 mx-auto text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
          </div>
          <h3 class="text-xl font-medium text-gray-900 dark:text-gray-100 mb-2">没有找到相关文章</h3>
          <p class="text-gray-600 dark:text-gray-400 mb-4">
            尝试使用不同的关键词或调整筛选条件
          </p>
          <a 
            href="/blog" 
            class="inline-block px-4 py-2 bg-accent text-white rounded-md hover:bg-accent/90 transition-colors"
          >
            浏览所有文章
          </a>
        </div>
      )}
    </>
  ) : (
    <!-- 初始状态，没有搜索查询 -->
    <div class="text-center py-12">
      <div class="mb-4">
        <svg class="w-16 h-16 mx-auto text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
        </svg>
      </div>
      <h3 class="text-xl font-medium text-gray-900 dark:text-gray-100 mb-2">开始搜索</h3>
      <p class="text-gray-600 dark:text-gray-400">
        在左侧输入关键词搜索文章
      </p>
    </div>
  )}
</div>

<style>
  /* 搜索结果高亮样式 */
  mark {
    background-color: var(--accent);
    color: var(--accent-contrast);
    padding: 0 2px;
    border-radius: 2px;
  }
  
  /* 响应式调整 */
  @media (max-width: 768px) {
    .search-results {
      padding: 0;
    }
    
    .search-results article {
      padding: 1rem;
    }
  }
</style>